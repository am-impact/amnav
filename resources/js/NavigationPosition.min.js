!function(i){Craft.NavigationPosition=Garnish.Base.extend({$field:null,$current:null,$elements:null,$switchField:null,$hiddenFields:null,$deleteMessage:null,$tempBefore:null,$tempAfter:null,$tempUnder:null,$chosenField:null,$parentIdField:null,$prevIdField:null,parentId:0,prevId:-1,settings:{},init:function(e,t){if(this.settings=t,this.$field=i("[id$="+e+"]"),this.$current=this.$field.find(".row--current"),this.$current.length&&(this.$current.addClass("row--disabled"),this.$current.parent().find("li .row").addClass("row--disabled"),this.$current=this.$current.closest("li")),this.settings.maxLevels.length){var s=this,n=this.$field.find("li").filter(function(){return i(this).data("level")>s.settings.maxLevels});n.length&&n.find(".row").addClass("row--disabled")}this.$elements=this.$field.find(".row:not(.row--disabled)"),this.$switchField=this.$field.find(".lightswitch"),this.$hiddenFields=this.$field.find(".navigation-position__field"),this.$deleteMessage=this.$field.find(".navigation-position__message"),this.$chosenField=this.$field.find(".amnav__position--chosen"),this.$parentIdField=this.$field.find(".amnav__position--parentId"),this.$prevIdField=this.$field.find(".amnav__position--prevId"),this.addListener(this.$switchField,"click","toggleFields"),this.addListener(this.$elements,"click","createIndications"),this.$field.find(".row").length||this.createOneIndication()},toggleFields:function(){this.$switchField.find("input").val()?(this.$hiddenFields.removeClass("hidden"),this.$deleteMessage.addClass("hidden")):(this.$hiddenFields.addClass("hidden"),this.$deleteMessage.removeClass("hidden"))},createOneIndication:function(){this.$tempBefore=i('<li class="indication" data-position-type="new"><div class="indication--label"><strong>'+Craft.t("Add to navigation")+"</strong></div></li>").appendTo(this.$field.find(".amnav__builder")),this.addListener(this.$tempBefore,"click","indicatePosition")},createIndications:function(e){var t=i(e.currentTarget).closest("li"),s=t.find("> ul"),n=t.data("level"),d=t.hasClass("amnav__node--active");null!==this.$tempBefore&&(this.$tempBefore.remove(),this.$tempAfter.remove(),null!==this.$tempUnder&&this.$tempUnder.remove(),this.$elements.closest("li").removeClass("amnav__node--active")),d||(t.addClass("amnav__node--active"),this.$tempBefore=i('<li class="indication" data-position-type="before"><div class="indication--label"><strong>'+Craft.t("Position here")+"</strong></div></li>").insertBefore(t),this.$tempAfter=i('<li class="indication" data-position-type="after"><div class="indication--label"><strong>'+Craft.t("Position here")+"</strong></div></li>").insertAfter(t),(!this.settings.maxLevels.length||this.settings.maxLevels.length&&n+1<=this.settings.maxLevels)&&(this.$tempUnder=s.length?i('<li class="indication" data-position-type="under"><div class="indication--label"><strong>'+Craft.t("Position here")+"</strong></div></li>").prependTo(s):i('<ul><li class="indication" data-position-type="under"><div class="indication--label"><strong>'+Craft.t("Position here")+"</strong></li></div></ul>").appendTo(t),this.addListener(this.$tempUnder,"click","indicatePosition")),this.addListener(this.$tempBefore,"click","indicatePosition"),this.addListener(this.$tempAfter,"click","indicatePosition"),this.cleanIndications()),this.updateInputs(!0)},cleanIndications:function(){if(this.$current.length){var i=this.$current.prev(),e=this.$current.next(),t=i.data("position-type"),s=e.data("position-type"),n=!1;if(i.hasClass("indication")?n=t:e.hasClass("indication")&&(n=s),n!==!1)switch(n){case"before":this.$tempBefore.remove();break;case"after":this.$tempAfter.remove();break;case"under":this.$tempUnder.remove()}}},indicatePosition:function(e){var t=this.$field.find(".indication"),s=i(e.currentTarget),n=this.$field.find(".amnav__node--active > .row > .amnav__node"),d=n.closest("li").parent("ul").parent("li").children(".row").children(".amnav__node"),a=s.data("position-type");switch(s.is("ul")&&(s=s.find("li"),a=s.data("position-type")),t.removeClass("indication--active"),s.addClass("indication--active"),this.prevId=0,this.parentId=d.length?d.data("id"):0,a){case"before":var l=s.prev().find("> .row > .amnav__node");l.length&&(this.prevId=l.data("id"));break;case"after":this.prevId=n.data("id");break;case"under":this.prevId=-1,this.parentId=n.data("id")}this.updateInputs()},updateInputs:function(i){this.$chosenField.val(i?0:1),this.$parentIdField.val(this.parentId),this.$prevIdField.val(this.prevId)}})}(jQuery);